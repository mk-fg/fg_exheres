# Copyright 2011 Mike Kazantsev
# Copyright 2010 Jonathan Dahan <jedahan@gmail.com>
# Distributed under the terms of the GNU General Public License v2

require scons

SUMMARY="A scalable, high-performance, schema-free, document-oriented database."

HOMEPAGE="http://www.mongodb.org"
DOWNLOADS="http://downloads.mongodb.org/src/${PN}-src-r${PV}.tar.gz -> ${PNV}.tar.gz"

LICENCES="AGPL-3"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES="
    build:
        dev-libs/boost
    build+run:
        dev-libs/spidermonkey[<1.8.5]
"

BUGS_TO="mk.fraggod@gmail.com"


WORK="${WORKBASE}/${PN}-src-r${PV}"

SCONS_SRC_COMPILE_PARAMS=( --config=auto all )
SCONS_SRC_INSTALL_PARAMS=( --prefix="${IMAGE}"/usr --full install )

src_prepare() {
    # Hack for linux-3.X compatibility on x86
    if edo uname -m | grep -q '^i686$' && edo uname -r | grep -q '^3\.'
    then grep -lr linux2 . | edo xargs sed -i 's/linux2/linux3/g'
    fi
}

src_install() {
    scons_src_install
    emagicdocs
}
