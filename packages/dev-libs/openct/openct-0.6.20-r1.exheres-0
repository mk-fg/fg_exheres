# Copyright 2011-2012 Mike Kazantsev
# Distributed under the terms of the GNU General Public License v2
# Based upon 'openct-0.6.20.ebuild' from Gentoo, which is:
#  Copyright 1999-2010 Gentoo Foundation

require autoprune systemd-service

SUMMARY="Reader driver interface for various non-standard readers."

HOMEPAGE="http://www.opensc-project.org/openct/"
DOWNLOADS="http://www.opensc-project.org/files/${PN}/${PNV}.tar.gz"

LICENCES="LGPL-2.1"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="doc
    pcsc-lite [[ description = [ Register ifdhandler for PC/SC Architecture smartcard middleware library. ] ]]"

DEPENDENCIES="
    build:
        doc? ( app-doc/doxygen )
    build+run:
        dev-libs/libusb:0.1
        group/openct
        sys-fs/udev[>=096]
        user/openct
        pcsc-lite? ( sys-apps/pcsc-lite )
"

BUGS_TO="mk.fraggod@gmail.com"
REMOTE_IDS="freshmeat:${PN}"


DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( doc "doc api-doc" "pcsc-lite pcsc" )
DEFAULT_SRC_CONFIGURE_PARAMS=(
    --localstatedir=/var\
    --disable-sunray\
    --disable-sunrayclient\
    --enable-usb\
    --enable-non-privileged\
    --with-daemon-user=openct\
    --with-daemon-groups=usb\
    --with-udev="/$LIBDIR/udev" )

src_install() {
    autoprune_src_install
    install_systemd_files

    insinto /etc/udev/rules.d/
    newins etc/openct.udev 70-openct.rules

    if option systemd; then
        insinto /$LIBDIR/tmpfiles.d
        hereins openct.conf <<EOF
d /run/openct 0750 openct openct -
EOF
    fi
}
