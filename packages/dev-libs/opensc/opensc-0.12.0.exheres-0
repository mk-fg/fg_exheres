# Copyright 2011 Mike Kazantsev
# Distributed under the terms of the GNU General Public License v2
# Based upon 'opensc-11.13.ebuild' from Gentoo, which is:
#  Copyright 1999-2010 Gentoo Foundation

SUMMARY="SmartCard library and applications."
DESCRIPTION="OpenSC provides a set of libraries and utilities to work with
smart cards. Its main focus is on cards that support cryptographic operations,
and facilitate their use in security applications such as authentication, mail
encryption and digital signatures. OpenSC implements the  PKCS#11 API so
applications supporting this API (such as Mozilla Firefox and Thunderbird)
can use it. On the card OpenSC implements the  PKCS#15 standard and aims to
be compatible with every software/card that does so, too."

HOMEPAGE="http://www.opensc-project.org/opensc/"
DOWNLOADS="http://www.opensc-project.org/files/${PN}/${PNV}.tar.gz"

LICENCES="LGPL-2.1"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS="doc
    openct [[ description = [ Support for accessing smartcards via OpenCT
        middleware. OpenCT implements a reader driver interface for various
        non-standard readers on Linux, and is meant to be used with OpenSC.
        pcsc-lite middleware should be preferred, if possible. ] ]]
    pcsc-lite [[ description = [ Support for accessing smartcards via PC/SC
        Architecture smartcard middleware library. This is more modern and
        better maintained middleware than OpenCT with much wider and extensive
        hardware support, should be preferrable to OpenCT. ] ]]"

DEPENDENCIES="
    build: dev-util/pkg-config
    build+run:
        dev-libs/openssl
        sys-libs/readline
        sys-libs/zlib
        openct? ( dev-libs/openct[>=0.5.0] )
        pcsc-lite? ( sys-apps/pcsc-lite[>=1.3.0] )"

BUGS_TO="mk.fraggod@gmail.com"
UPSTREAM_DOCUMENTATION="
    ${HOMEPAGE}wiki/ApplicationSupport [[ lang = en
        description = [ PKCS11 infrastructure support in applications ] ]]
    ${HOMEPAGE}wiki/SupportedHardware [[ lang = en
        description = [ Hardware support status ] ]]"


DEFAULT_SRC_CONFIGURE_OPTION_ENABLES=( doc openct "pcsc-lite pcsc" )
DEFAULT_SRC_CONFIGURE_PARAMS=(
    --docdir="/usr/share/doc/${PNVR}"
    --htmldir="/usr/share/doc/${PNVR}/html"
    --enable-man
    --enable-openssl
    --enable-readline
    --enable-zlib
    --disable-ctapi
    --disable-cardmod )

src_install() {
    default
    rmdir "${IMAGE}"/usr/sbin
    option doc || rmdir -p "${IMAGE}"/usr/share/doc/opensc-0.12.0/html
}
