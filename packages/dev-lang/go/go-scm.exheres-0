# Copyright 2011 Mike Kazantsev
# Distributed under the terms of the GNU General Public License v2

SCM_REPOSITORY="https://go.googlecode.com/hg/"

require scm-hg zsh-completion elisp-optional [ source_directory=misc/emacs ]

SUMMARY="Open source project to make programmers more productive."

HOMEPAGE="http://golang.org/"

LICENCES="BSD-3"
SLOT="0"
PLATFORMS="~amd64 ~x86"
MYOPTIONS=""

DEPENDENCIES=""

BUGS_TO="mk.fraggod@gmail.com"


GO_INSTALL_PATH=/usr/lib/go

src_compile() {
    elisp-optional_src_compile

    edo cd src
    # Disables all tests, as they do insane stuff like test-writing into /
    sed -i 's/gomake test/true \0/' run.bash
    GOROOT_FINAL="${GO_INSTALL_PATH}" edo ./all.bash
}

src_install() {
    elisp-optional_src_install
    dozshcompletion misc/zsh/go _go

    edo mkdir -p "${IMAGE}"/usr/bin
    exeinto "${GO_INSTALL_PATH}"/bin
    for bin in $(ls -1 bin); do
        doexe "bin/${bin}"
        dosym "${GO_INSTALL_PATH}/bin/${bin}" "/usr/bin/${bin}"
    done

    insinto "${GO_INSTALL_PATH}"
    doins -r include lib pkg
}
